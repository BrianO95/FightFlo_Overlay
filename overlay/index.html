<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>FightFlo Overlay Manager</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&family=Oswald:wght@400;700&family=Montserrat:wght@400;700&family=Lato:wght@400;700&family=Exo+2:wght@400;700&display=swap"
    rel="stylesheet">
  <style>
    :root {
      --radius: 0px;
      --container-bg: #222;
      --container-opacity: 1;
      --shadow-blur: 6px;
      --shadow-spread: 0px;
      --shadow-opacity: 0.15;
      --shadow-color: rgba(255, 255, 255, var(--shadow-opacity));
      --overlay-gap: 15px;
      --division-margin: 8px;
    }

    /* body {
      font-family: Arial, sans-serif;
      background: transparent;
      color: rgb(255, 255, 255);
      margin: 0;
      height: 100vh;
      display: grid;
      place-items: center;
    } */

    body {
  font-family: Arial, sans-serif;
  background: rgba(0, 0, 0, 0.85); /* dark grey fallback */
  color: #fff;
  margin: 0;
  height: 100vh;
  display: grid;
  place-items: center;
}

    .page-grid {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 30px;
      width: 100%;
      height: 100%;
      padding: 30px;
      box-sizing: border-box;
    }

    .panel {
      background: #1c1c1c;
      border-radius: 10px;
      padding: 20px;
      overflow-y: auto;
      max-height: 90vh;
    }

    .setting h3 {
      margin: 10px 0 6px 0;
      font-weight: 500;
      font-size: 14px;
    }

    input[type="text"] {
      padding: 6px 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: none;
      font-size: 14px;
      background: #2a2a2a;
      color: white;
      width: 95%;
    }

    input[type="range"] {
      width: 100%;
    }

    button {
      padding: 6px 12px;
      margin: 2px;
      border: none;
      border-radius: 6px;
      background: #444;
      border: 1px solid rgb(255, 255, 255);
      color: white;
      cursor: pointer;
      font-size: 13px;
    }

    button:hover {
      background: #666;
    }

    .color-options {
      display: flex;
      gap: 8px;
      margin: 4px 0;
      flex-wrap: wrap;
    }

    .font-options {
      display: flex;
      flex-direction: column;
      gap: 4px;
      margin: 4px 0;
    }

    .center-column {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      gap: 25px;
    }

    /* Instructions button */
    .instructions-btn {
      margin-top: 60px;
      margin-bottom: 100px;
      text-align: center;
    }

    .banner-wrapper {
      width: 800px;
      border-radius: var(--radius);
      padding: 15px;
      text-align: center;
      background: transparent;
    }

    .controls-bar {
      display: flex;
      justify-content: center;
      align-items: center;
      background: #111;
      border-radius: 10px;
      overflow: hidden;
      width: 800px;
      /* match banner width */
      margin-bottom: 60px;
      /* extra spacing */
    }

    .control-section {
      padding: 8px 14px;
      border-right: 1px solid #333;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .control-section:last-child {
      border-right: none;
    }

    .overlay-container {
      display: flex;
      justify-content: center;
      align-items: stretch;
      gap: var(--overlay-gap);
      border-radius: var(--radius);
    }

    .box {
      flex: 1;
      background: var(--container-bg);
      opacity: var(--container-opacity);
      border-radius: var(--radius);
      font-size: 20px;
      font-weight: bold;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 56px;
      box-shadow: 0 0 var(--shadow-blur) var(--shadow-spread) var(--shadow-color);
      position: relative;
    }

    .timer-box {
      flex: 0 0 200px;
      font-size: 26px;
      font-weight: 700;
    }

    #round-timer {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 8px;
    }

    #round-timer div:first-child {
      padding-right: 8px;
      border-right: 1px solid #555;
    }

    .corner-color {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 12px;
      height: 60%;
      border-radius: 3px;
    }

    .corner-left {
      left: 14px;
    }

    .corner-right {
      right: 14px;
    }

    .fighter-left {
      padding-right: 34px;
    }

    .fighter-right {
      padding-left: 34px;
    }

    .champion-badge {
      background: #ffd700;
      color: #000;
      font-weight: bold;
      font-size: 12px;
      width: 16px;
      height: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 3px;
      margin: 0 10px;
    }

    .division-box {
      background: var(--container-bg);
      opacity: var(--container-opacity);
      border-radius: var(--radius);
      font-size: 18px;
      font-style: italic;
      text-align: center;
      padding: 8px;
      margin: var(--division-margin) auto 0 auto;
      width: 60%;
      box-shadow: 0 0 var(--shadow-blur) var(--shadow-spread) var(--shadow-color);
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      /* centers the text span */
      padding-left: 56px;
    }

    .division-logo {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      height: 30px;
      /* adjust size as you like */
      width: auto;
      pointer-events: none;
      /* avoids capturing clicks in OBS Interact */
    }

    .division-text {
      text-align: center;
      width: 100%;
    }

    .fight-list {
      list-style: none;
      padding: 0;
    }

    .fight-list li {
      padding: 8px;
      margin: 6px 0;
      background: #2a2a2a;
      border-radius: 6px;
    }

    .fight-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .fight-actions {
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
    }

    .edit-form {
      margin-top: 8px;
      background: #1a1a1a;
      padding: 8px;
      border-radius: 6px;
    }

    .edit-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin: 6px 0;
      flex-wrap: wrap;
    }

    .edit-row input[type="text"] {
      width: 180px;
    }

    .edit-row .color-options label {
      font-size: 12px;
    }

    /* Divider styling */
    .divider {
      border: 0;
      border-top: 1px solid #333;
      margin: 10px 0;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background: rgba(0, 0, 0, 0.8);
    }

    .modal-content {
      background: #1c1c1c;
      margin: 10% auto;
      padding: 20px;
      border-radius: 10px;
      border: 1px solid yellow;
      width: 60%;
      color: white;
    }

    .close {
      float: right;
      font-size: 30px;
      cursor: pointer;
      color: #aaa;
    }

    .close:hover {
      color: white;
    }
  </style>
</head>

<body>
  <div class="page-grid">
    <!-- LEFT PANEL -->
    <div class="panel">
      <div class="setting">
        <h3>Letter Spacing - Names</h3><input type="range" min="0" max="10" step="0.5" value="2"
          oninput="changeLetterSpacing('names',this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Letter Spacing - RD/Timer</h3><input type="range" min="0" max="10" step="0.5" value="2"
          oninput="changeLetterSpacing('rdtimer',this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Letter Spacing - Division</h3><input type="range" min="0" max="10" step="0.5" value="2"
          oninput="changeLetterSpacing('division',this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Border Radius</h3><input type="range" id="borderRadius" min="0" max="20" step="1" value="0"
          oninput="changeRadius(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Container Color</h3><input type="range" id="containerColor" min="0" max="85" step="5" value="34"
          oninput="changeContainerColor(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Container Opacity</h3><input type="range" id="containerOpacity" min="0.3" max="1" step="0.05" value="1"
          oninput="changeContainerOpacity(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Font Style</h3>
        <div class="font-options">
          <label><input type="radio" name="fontStyle" value="Arial, sans-serif" checked
              onclick="changeFont(this.value)"> Arial</label>
          <label><input type="radio" name="fontStyle" value="'Roboto Condensed', sans-serif"
              onclick="changeFont(this.value)"> Roboto Condensed</label>
          <label><input type="radio" name="fontStyle" value="Oswald, sans-serif" onclick="changeFont(this.value)">
            Oswald</label>
          <label><input type="radio" name="fontStyle" value="Montserrat, sans-serif" onclick="changeFont(this.value)">
            Montserrat</label>
          <label><input type="radio" name="fontStyle" value="Lato, sans-serif" onclick="changeFont(this.value)">
            Lato</label>
          <label><input type="radio" name="fontStyle" value="'Exo 2', sans-serif" onclick="changeFont(this.value)"> Exo
            2</label>
        </div>
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Box Shadow Blur</h3><input type="range" min="0" max="40" step="1" value="6"
          oninput="changeShadowBlur(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Box Shadow Spread</h3><input type="range" min="0" max="20" step="1" value="0"
          oninput="changeShadowSpread(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Box Shadow Opacity</h3><input type="range" min="0" max="1" step="0.05" value="0.15"
          oninput="changeShadowOpacity(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Box Shadow Color</h3>
        <div class="color-options">
          <label><input type="radio" name="shadowColor" value="none" checked onclick="changeShadowColor(this.value)">
            None</label>
          <label><input type="radio" name="shadowColor" value="255,255,255" onclick="changeShadowColor(this.value)">
            White</label>
          <label><input type="radio" name="shadowColor" value="0,0,0" onclick="changeShadowColor(this.value)">
            Black</label>
          <label><input type="radio" name="shadowColor" value="255,59,48" onclick="changeShadowColor(this.value)">
            Red</label>
          <label><input type="radio" name="shadowColor" value="13,110,253" onclick="changeShadowColor(this.value)">
            Blue</label>
          <label><input type="radio" name="shadowColor" value="255,215,0" onclick="changeShadowColor(this.value)">
            Yellow</label>
          <label><input type="radio" name="shadowColor" value="0,255,0" onclick="changeShadowColor(this.value)">
            Green</label>
          <label><input type="radio" name="shadowColor" value="128,0,128" onclick="changeShadowColor(this.value)">
            Purple</label>
        </div>
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Spacing Between Fighter/Timer Boxes</h3><input type="range" min="0" max="50" step="1" value="15"
          oninput="changeOverlayGap(this.value)">
      </div>
      <hr class="divider">
      <div class="setting">
        <h3>Spacing Between Division & Boxes</h3><input type="range" min="0" max="50" step="1" value="8"
          oninput="changeDivisionMargin(this.value)">
      </div>
    </div>

    <!-- CENTER PANEL -->
    <div class="center-column">
      <div class="instructions-btn">
        <button onclick="openModal()">Instructions</button>
      </div>

      <div class="controls-bar">
        <div class="control-section">
          <button onclick="prevFight()">Prev</button>
          <button onclick="nextFight()">Next</button>
        </div>
        <div class="control-section">
          <button onclick="decreaseRound()">- RD</button>
          <button onclick="increaseRound()">+ RD</button>
          <button onclick="resetRound()">Reset RD</button>
        </div>
        <div class="control-section">
          <button onclick="startTimer()">Start</button>
          <button onclick="stopTimer()">Stop</button>
          <button onclick="resetTimer()">Reset</button>
        </div>
        <div class="control-section">
          <input type="text" id="customTime" placeholder="mm:ss" style="width:70px;text-align:center;">
          <button onclick="setCustomTime()">Set</button>
        </div>
      </div>

      <div class="banner-wrapper" id="bannerWrapper">
        <div class="overlay-container">
          <div class="box fighter-left" id="fighterABox">
            <div class="corner-color corner-right" id="fighterAColor"></div>
            <span id="fighterAMarker"></span>
            <span id="fighterAText">Fighter A</span>
          </div>
          <div class="box timer-box">
            <div id="round-timer">
              <div id="round">RD 1</div>
              <div id="timer">5:00</div>
            </div>
          </div>
          <div class="box fighter-right" id="fighterBBox">
            <div class="corner-color corner-left" id="fighterBColor"></div>
            <span id="fighterBText">Fighter B</span>
            <span id="fighterBMarker"></span>
          </div>
        </div>
        <div class="division-box" id="divisionBox">
          <img src="https://BrianO95.github.io/FightFlo_Overlay/overlay/FFLogo.png" alt="FightFlo Logo"
            class="division-logo" />
          <span class="division-text" id="divisionText">Division</span>
        </div>

      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="panel">
      <div class="setting">
        <h3>Fighter A</h3>
        <input type="text" id="fighterA" placeholder="Fighter A - Left box"><br>
        <div class="color-options" id="addAColors">
          <label><input type="radio" name="fighterAColor" value="none" checked> None</label>
          <label><input type="radio" name="fighterAColor" value="#ff3b30"> Red</label>
          <label><input type="radio" name="fighterAColor" value="#0d6efd"> Blue</label>
          <label><input type="radio" name="fighterAColor" value="#ffffff"> White</label>
          <label><input type="radio" name="fighterAColor" value="#000000"> Black</label>
        </div>
        <label><input type="checkbox" id="fighterAChampion"> Champion</label>
      </div>
      <hr class="divider">

      <div class="setting">
        <h3>Fighter B</h3>
        <input type="text" id="fighterB" placeholder="Fighter B - Right box"><br>
        <div class="color-options" id="addBColors">
          <label><input type="radio" name="fighterBColor" value="none" checked> None</label>
          <label><input type="radio" name="fighterBColor" value="#ff3b30"> Red</label>
          <label><input type="radio" name="fighterBColor" value="#0d6efd"> Blue</label>
          <label><input type="radio" name="fighterBColor" value="#ffffff"> White</label>
          <label><input type="radio" name="fighterBColor" value="#000000"> Black</label>
        </div>
        <label><input type="checkbox" id="fighterBChampion"> Champion</label>
      </div>
      <hr class="divider">

      <div class="setting">
        <h3>Division</h3>
        <input type="text" id="divisionInput" placeholder="e.g Light Heavyweight Bout">
      </div>
      <hr class="divider">

      <div class="setting"><button onclick="addFight()">Add Fight</button></div>
      <hr class="divider">

      <div class="setting">
        <h3>Fight List</h3>
        <ul id="fightList" class="fight-list"></ul>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="instructionsModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h2>How to Use FightFlo Banner Overlay</h2>
      <p>1. Use the <strong>right panel</strong> to add fights (Fighter A, Fighter B, division, champion markers, corner
        colors). Listed Fights can be edited, deleted, and rearranged.</p>
      <p>2. Navigate fights with <strong>Prev/Next</strong> buttons.</p>
      <p>3. Adjust rounds with - RD / + RD / Reset (sets to RD 1).</p>
      <p>4. Control the timer with Start / Stop / Reset or set a custom time. Stop also acts as pause. For custom time, be sure to enter as <strong>"mm" ":" "ss"</strong>, then set, then start.</p>
      <p>5. Style the overlay using the <strong>left panel</strong> (fonts, spacing, colors, shadows).</p>
      <p>6. The banner updates automatically when you add or edit fights.</p>
     <h2>Connect to OBS</h2>
      <p>1. Open <strong>OBS</strong>.</p>
      <p>2. Add <strong>Source</strong> then select <strong>Browser</strong>.</p>
      <p>3. Select <strong>Properties</strong> then copy/paste your browser overlay URL into the Propertie's
        <strong>URL</strong> section. </p>
      <p>4. Ensure the Propertie's <strong>Width</strong> is 1500 or more, for convenient data entry.</p>
      <p>5. Deselect the <strong>"Refresh browser when scene becomes active"</strong>. Otherwise, your data will be gone
        every time you return to the scene containing the overlay browser source.</p>
      <p>6. To crop, hold <strong>ALT</strong> while manipulating the drag points.</p>
      <h2>Interact in OBS</h2>
      <p>1. While having the <strong>Browser</strong> source selected, click the <strong>Interact</strong> button.</p>
      <p>2. The <strong>Interact</strong> pop-up window is the only way to set & display the data you enter. Everything
        is done through that window.</p>
      <p>3. The <strong>Interact</strong> pop-up window can be opened and closed and will retain the your data, as long
        as you do not close out OBS entirely.</p>
      <h2>What NOT to do</h2>
      <p>1. Do <strong>NOT</strong> keep <strong>"Refresh browser when scene becomes active"</strong> selected. For the
        love of God, <strong> DESELECT IT</strong>. </p>
      <p>2. Do <strong>NOT</strong> click the <strong>Refresh</strong> button while having the Browser source selected.
        This will wipe & reset all the data you entered.</p>
      <p>3. Do <strong>NOT</strong> close out the overlay webpage tab on your internet browser while actively using it
        through OBS. You can surf the web on other tabs without interupting the overlay.</p>
      <p>4. Do <strong>NOT</strong> enter your data on the webpage and expect it to populate on OBS. It won't.</p>
      <p>5. Do <strong>NOT</strong> expect your current data to hold beyond your current OBS session. Once the source is
        removed, webpage tab closed, or OBS session is terminated, your data will be gone.</p>


    </div>
  </div>

  <script>
    let fights = [];
    let currentFightIndex = 0;
    let round = 1;
    let timerInterval;
    let timeLeft = 300;
    let shadowColorValue = 'none';

    function applyShadow() {
      const opacity = getComputedStyle(document.documentElement).getPropertyValue('--shadow-opacity');
      if (shadowColorValue === 'none') {
        document.documentElement.style.setProperty('--shadow-color', 'transparent');
      } else {
        document.documentElement.style.setProperty('--shadow-color', `rgba(${shadowColorValue},${opacity})`);
      }
    }
    function changeShadowBlur(v) { document.documentElement.style.setProperty('--shadow-blur', v + 'px'); applyShadow(); }
    function changeShadowSpread(v) { document.documentElement.style.setProperty('--shadow-spread', v + 'px'); applyShadow(); }
    function changeShadowOpacity(v) { document.documentElement.style.setProperty('--shadow-opacity', v); applyShadow(); }
    function changeShadowColor(val) { shadowColorValue = val; applyShadow(); }

    function changeOverlayGap(v) { document.documentElement.style.setProperty('--overlay-gap', v + 'px'); }
    function changeDivisionMargin(v) { document.documentElement.style.setProperty('--division-margin', v + 'px'); }

    function changeLetterSpacing(type, val) {
      if (type === 'names') { document.querySelectorAll('#fighterAText,#fighterBText').forEach(el => el.style.letterSpacing = val + 'px'); }
      if (type === 'rdtimer') { document.querySelectorAll('#round,#timer').forEach(el => el.style.letterSpacing = val + 'px'); }
      if (type === 'division') { document.querySelector('.division-text').style.letterSpacing = val + 'px'; }

    }
    function changeRadius(v) { document.documentElement.style.setProperty('--radius', v + 'px'); }
    function changeContainerColor(val) { const hex = val.toString(16).padStart(2, '0'); document.documentElement.style.setProperty('--container-bg', `#${hex}${hex}${hex}`); }
    function changeContainerOpacity(v) { document.documentElement.style.setProperty('--container-opacity', v); }
    function changeFont(font) {
      document.querySelectorAll('#fighterAText,#fighterBText,#round,#timer,.division-text')
        .forEach(el => el.style.fontFamily = font);
    }


    function formatTime(sec) { const m = Math.floor(sec / 60), s = sec % 60; return `${m}:${s.toString().padStart(2, '0')}`; }
    function startTimer() { stopTimer(); timerInterval = setInterval(() => { if (timeLeft > 0) { timeLeft--; updateDisplay(); } else stopTimer(); }, 1000); }
    function stopTimer() { clearInterval(timerInterval); }
    function resetTimer() { stopTimer(); timeLeft = 300; updateDisplay(); }
    function setCustomTime() {
      const input = document.getElementById('customTime').value;
      const [m, s] = (input || '').split(':').map(Number);
      if (!isNaN(m) && !isNaN(s) && s >= 0 && s < 60) { timeLeft = m * 60 + s; updateDisplay(); }
      else alert("Enter mm:ss");
    }

    function increaseRound() { round++; updateDisplay(); }
    function decreaseRound() { if (round > 1) round--; updateDisplay(); }
    function resetRound() { round = 1; updateDisplay(); }
    function resetRoundAndTimer() { round = 1; timeLeft = 300; stopTimer(); updateDisplay(); }

    function nextFight() { if (!fights.length) return; currentFightIndex = (currentFightIndex + 1) % fights.length; resetRoundAndTimer(); updateDisplay(); }
    function prevFight() { if (!fights.length) return; currentFightIndex = (currentFightIndex - 1 + fights.length) % fights.length; resetRoundAndTimer(); updateDisplay(); }

    function getSelected(name) {
      const radios = document.querySelectorAll(`input[name="${name}"]`);
      for (const r of radios) { if (r.checked) return r.value; }
      return 'none';
    }
    function colorRadiosHTML(groupName, selected) {
      const opts = [
        { v: 'none', label: 'None' },
        { v: '#ff3b30', label: 'Red' },
        { v: '#0d6efd', label: 'Blue' },
        { v: '#ffffff', label: 'White' },
        { v: '#000000', label: 'Black' }
      ];
      return opts.map(o => `<label><input type="radio" name="${groupName}" value="${o.v}" ${o.v === selected ? 'checked' : ''}> ${o.label}</label>`).join(' ');
    }
    function addFight() {
      const a = document.getElementById('fighterA').value.trim();
      const b = document.getElementById('fighterB').value.trim();
      const div = document.getElementById('divisionInput').value.trim();
      if (!a || !b || !div) return;
      fights.push({ a, b, division: div, aColor: getSelected('fighterAColor'), bColor: getSelected('fighterBColor'), aChamp: document.getElementById('fighterAChampion').checked, bChamp: document.getElementById('fighterBChampion').checked });
      document.getElementById('fighterA').value = ''; document.getElementById('fighterB').value = ''; document.getElementById('divisionInput').value = ''; document.getElementById('fighterAChampion').checked = false; document.getElementById('fighterBChampion').checked = false;
      document.querySelector('#addAColors input[value="none"]').checked = true;
      document.querySelector('#addBColors input[value="none"]').checked = true;
      renderFightList(); if (fights.length === 1) updateDisplay();
    }
    function renderFightList() {
      const list = document.getElementById('fightList'); list.innerHTML = '';
      fights.forEach((f, i) => {
        const li = document.createElement('li');
        const header = document.createElement('div'); header.className = 'fight-header';
        header.innerHTML = `<div><strong>${f.a}</strong> vs <strong>${f.b}</strong> — <em>${f.division}</em></div><div class="fight-actions"><button onclick="moveFight(${i},-1)">▲</button><button onclick="moveFight(${i},1)">▼</button><button onclick="toggleEdit(${i})" id="editBtn-${i}">Edit</button><button onclick="deleteFight(${i})">Delete</button></div>`;
        li.appendChild(header);
        const edit = document.createElement('div'); edit.className = 'edit-form'; edit.id = `edit-${i}`; edit.style.display = 'none';
        edit.innerHTML = `<div class="edit-row"><input type="text" id="editA-${i}" value="${f.a}" placeholder="Fighter A"><div class="color-options" id="editAColors-${i}">${colorRadiosHTML(`editAColor-${i}`, f.aColor)}</div><label><input type="checkbox" id="editAChamp-${i}" ${f.aChamp ? 'checked' : ''}> Champion</label></div><div class="edit-row"><input type="text" id="editB-${i}" value="${f.b}" placeholder="Fighter B"><div class="color-options" id="editBColors-${i}">${colorRadiosHTML(`editBColor-${i}`, f.bColor)}</div><label><input type="checkbox" id="editBChamp-${i}" ${f.bChamp ? 'checked' : ''}> Champion</label></div><div class="edit-row"><input type="text" id="editDivision-${i}" value="${f.division}" placeholder="Division"></div><div class="edit-row"><button onclick="saveEdit(${i})">Save</button><button onclick="cancelEdit(${i})">Cancel</button></div>`;
        li.appendChild(edit); list.appendChild(li);
      });
    }
    function toggleEdit(i) {
      const el = document.getElementById(`edit-${i}`); const btn = document.getElementById(`editBtn-${i}`); const isOpen = el.style.display !== 'none';
      document.querySelectorAll('.edit-form').forEach(e => e.style.display = 'none'); document.querySelectorAll('.fight-actions button[id^="editBtn-"]').forEach(b => b && (b.textContent = 'Edit'));
      el.style.display = isOpen ? 'none' : 'block'; if (!isOpen && btn) btn.textContent = 'Close';
    }
    function saveEdit(i) {
      const f = fights[i];
      const a = document.getElementById(`editA-${i}`).value.trim(); const b = document.getElementById(`editB-${i}`).value.trim(); const div = document.getElementById(`editDivision-${i}`).value.trim();
      if (a) f.a = a; if (b) f.b = b; if (div) f.division = div;
      const aColor = document.querySelector(`input[name="editAColor-${i}"]:checked`); const bColor = document.querySelector(`input[name="editBColor-${i}"]:checked`);
      f.aColor = aColor ? aColor.value : f.aColor; f.bColor = bColor ? bColor.value : f.bColor;
      f.aChamp = document.getElementById(`editAChamp-${i}`).checked; f.bChamp = document.getElementById(`editBChamp-${i}`).checked;
      renderFightList(); updateDisplay();
    }
    function cancelEdit(i) { const el = document.getElementById(`edit-${i}`); if (el) el.style.display = 'none'; const btn = document.getElementById(`editBtn-${i}`); if (btn) btn.textContent = 'Edit'; }
    function moveFight(index, dir) { const newIndex = index + dir; if (newIndex < 0 || newIndex >= fights.length) return; const [fight] = fights.splice(index, 1); fights.splice(newIndex, 0, fight); if (currentFightIndex === index) currentFightIndex = newIndex; renderFightList(); updateDisplay(); }
    function deleteFight(i) { fights.splice(i, 1); if (currentFightIndex >= fights.length) currentFightIndex = 0; renderFightList(); updateDisplay(); }

    function updateDisplay() {
      if (!fights.length) {
        document.getElementById('fighterAText').textContent = 'Fighter A'; document.getElementById('fighterBText').textContent = 'Fighter B'; document.getElementById('divisionText').textContent = 'Division';

        document.getElementById('fighterAColor').style.display = 'none'; document.getElementById('fighterBColor').style.display = 'none';
        document.getElementById('fighterAMarker').innerHTML = ''; document.getElementById('fighterBMarker').innerHTML = '';
      } else {
        const f = fights[currentFightIndex]; document.getElementById('fighterAText').textContent = f.a; document.getElementById('fighterBText').textContent = f.b; document.getElementById('divisionText').textContent = f.division;

        const aBar = document.getElementById('fighterAColor'); const bBar = document.getElementById('fighterBColor');
        if (f.aColor === 'none') { aBar.style.display = 'none'; } else { aBar.style.display = 'block'; aBar.style.background = f.aColor; }
        if (f.bColor === 'none') { bBar.style.display = 'none'; } else { bBar.style.display = 'block'; bBar.style.background = f.bColor; }
        document.getElementById('fighterAMarker').innerHTML = f.aChamp ? '<div class="champion-badge">C</div>' : ''; document.getElementById('fighterBMarker').innerHTML = f.bChamp ? '<div class="champion-badge">C</div>' : '';
      }
      document.getElementById('round').textContent = "RD " + round; document.getElementById('timer').textContent = formatTime(timeLeft);
    }
    renderFightList(); updateDisplay();

    function openModal() { document.getElementById("instructionsModal").style.display = "block"; }
    function closeModal() { document.getElementById("instructionsModal").style.display = "none"; }
    window.onclick = function (e) { if (e.target == document.getElementById("instructionsModal")) closeModal(); }
  </script>
</body>

</html>
